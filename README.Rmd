---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# sharedgovernance

<!-- badges: start -->
<!-- badges: end -->

In an academic institution, many people participate in decision-making: the governing board, administrators, faculty, staff, students, and others. See [AAUP's FAQ](https://www.aaup.org/issues-higher-education/shared-governance/faqs-shared-governance) for more information. Good decisions come from informed people, and yet sometimes information is not available to everyone involved or is heavily curated before release. This package aggregates information from the federal IPEDS databases, College Scorecard, and other sources, generally as organized by the [collegetables.info](https://collegetables.info) site (which I also run), and organizes it in ways that lets community members all have free access to it. A common use case will be when there are discussions on the need to close departments. Faculty arguments often focus on qualitative factors, which can be powerful ("what does it mean for how much we value STEM if one cannot get a PhD in math anywhere in the state?") but having quantitative arguments can also help. Alternatively, a broader look at the data could argue that some closures do make sense.

Note I am doing this as a hobby on my own time -- nothing here reflects the views or work for any past, current, or future employer, nor of any organization. I'm just trying to save colleagues work when a new question arises.

Some caveats: this uses federal data and thus reflects the federal government's views on demographic categories. The data are mostly analyzed with R scripts at <https://github.com/bomeara/collegetables_source> with some minor tweaking in this package -- I've tried to be careful with all the coding, but there could be errors, especially comparing across years (category names can change, for example). For much of the original data, go to <https://nces.ed.gov/ipeds/> and <https://collegescorecard.ed.gov/data/>. For comparisons to a focal school, I use the schools that focal school chooses as comparisons and the schools NCES uses as comparisons. **If you see any issues, please add them to <https://github.com/bomeara/sharedgovernance/issues> or, even better, fix them and use a pull request.** 

## Installation

You can install the development version of sharedgovernance from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("bomeara/sharedgovernance")
```

This will take an unusually long time to install (10 minutes on my computer) -- just be patient. Note that some of the functions may take some time to run, too -- it can be doing operations across hundreds of thousands of rows (all majors by all degrees by all years by all institutions makes for a lot of data). But the advantage is that all the data are local, so you don't have to wait for web requests each time.

## Overview of functions

The main workhorse functions are:

* `sg_find_college(college_name, verbose=TRUE)`: finds the institution ID number for a college given its name (or part of its name). Returns the UNITID number used in federal data.
* `sg_compare_field_salaries(institution_id, focal_only=FALSE)`: returns a data.frame with average salaries by field and degree for the focal institution and its comparison institutions.
* `sg_return_graduates(institution_id, focal_only=FALSE)`: returns a data.frame with number of degrees awarded by field, degree, year, and institution for the focal institution and its comparison institutions.
* `sg_return_college_summary(institution_id, categories=c("Basic"), focal_only=FALSE)`: returns a data.frame with summary data from the comparison table for the focal institution and its comparisons. Categories can be found in the `categories_and_fields` dataset: see `table(categories_and_fields$Category)` for an overview.

You can also open the [collegetables.info](https://collegetables.info) site for a given institution with `sg_open_collegetables(institution_id)`.	

## Examples

Imagine we wanted to look into U. of Nebraska, Lincoln. First we have to find its ID number in the federal data. We find names that are closest to it (in this case, the punctuation used is slightly different, but it still finds it). Make sure to use the full name: "University of Nebraska, Lincoln" rather than ("U Nebraska Lincoln" or "UNL"). By default it prints out the top ten matches.

```{r}
library(sharedgovernance)
id <- sg_find_college("University of Nebraska, Lincoln")
```

We can look at average salaries of graduates for the focal institution (listed first by default) and its comparison institutions.

```{r}
grad_salaries <- sg_compare_field_salaries(id)
print(head(grad_salaries))
```

We can also look at number of degrees awarded over time.

```{r}
completions <- sg_return_graduates(id)
print(head(dplyr::select(completions, Institution, Classification, Degree, `Year`, `Grand total`),40))
```

These are just data.frames. We can export them to CSV files (i.e., `write.csv(completions, file="completions.csv")`) if analyzing them in Excel, Google Sheets, or another program is preferred. But we can also analyze them in R. For example, we can plot the number of Bachelors' degrees in 'Biology/Biological Sciences, General' over time for the focal institution and its comparisons.

```{r}
library(ggplot2)
library(dplyr)
bio_degrees <- completions |> dplyr::filter(Classification=="Biology/Biological Sciences, General", Degree=="Bachelors", focal==TRUE)
g <- ggplot(bio_degrees, aes(x=`Year`, y=`Grand total`, color=`First or Second Major`)) +
  geom_line() +
  geom_point() +
  labs(title="Biology/Biological Sciences, General Bachelors' Degrees Awarded Over Time",
	   y="Number of Degrees Awarded",
	   x="IPEDS Year")
print(g)
```

If we want basic info on this college, we can also get a summary table. 

```{r}
summary_data <- sg_return_college_summary(id, categories=c("Basic", "Institution_Finances", "Enrollment", "Library"), focal_only=TRUE)
print(summary_data[, c("Year", "Undergrad full time", "Revenue minus expenses", "Number of physical books")])
```

To see what categories are available, we can look at the `categories_and_fields` dataset.